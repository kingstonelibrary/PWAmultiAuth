<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Hello Firebase Auth</title>
</head>
<body>
  <h1>...Please wait</h1>
  <div id="info"></div>

  <script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-auth.js"></script>
  <!-- <script src="/js/config.js"></script> -->
  <script>
    var config = {
      apiKey: "AIzaSyCAQ_TOCtBTXel87hCCRdXy-L4eUPt1UFg",
      authDomain: "gcmproject-141802.firebaseapp.com",
    };
    firebase.initializeApp(config);
    let domain = document.domain;
    let port   = (domain === 'localhost')?  5000:80;

    firebase.auth().onAuthStateChanged( (user) => {
      console.log(user);

      //------------------------------------
      // 未ログイン状態で訪れた場合
      //------------------------------------
      if(user === null){
        showMessage('Not Login', 'ログインが必要な画面です');
        return(false);
      }

      //------------------------------------
      // メアド確認済み
      //------------------------------------
      if( user.emailVerified ) {
        showMessage('Login Complete!', `${user.displayName}さんがログインしました`);
      }
      //------------------------------------
      // メアド未確認
      //------------------------------------
      else {
        user.sendEmailVerification()
          .then(()=>{
            showMessage('Send confirm mail', `${user.email}宛に確認メールを送信しました`);
          })
          .catch((error)=>{
            showMessage('[Error] Can not send mail', `${user.email}宛に確認メールを送信できませんでした: ${error}`);
          });
      }
    });

    function showMessage(title, msg) {
      document.querySelector('h1').innerText    = title;
      document.querySelector('#info').innerHTML = msg;
    }

  </script>
</body>
</html>